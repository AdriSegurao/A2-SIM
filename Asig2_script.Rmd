---
title: "Assigment2: HR Analytics- Job"
date: "2025-12-15"
fontsize: 10pt
output:
  pdf_document:
    latex_engine: xelatex
    fig_crop: false
    toc: true
    toc_depth: 3
    number_sections: true
  word_document:
    toc: true
    toc_depth: 3
    number_sections: true
editor_options:
  chunk_output_type: console
---



# DATA PREPARATION

## Load data and libraries

This section loads all necessary libraries and imports the dataset to prepare for data analysis and modeling.

```{r setup, include=FALSE}

# --- Data manipulation and import ---
library(readr)        # Read CSV files
library(dplyr)        # Data manipulation (mutate, filter, select, etc.)
library(forcats)      # Factor variable handling
library(tidyr)        # Reshaping and tidying data
library(stringr)      # String manipulation

# --- Visualization ---
library(ggplot2)      # Data visualization
library(corrplot)     # Correlation plots
library(scales)       # Formatting axis labels, percentages, etc.

# --- Outlier and multivariate analysis ---
library(chemometrics) # Moutlier detection
library(FactoMineR)   # Multivariate description (catdes, PCA)

# --- Statistical modeling and diagnostics ---
library(car)          # Regression diagnostics (VIF, crPlots, etc.)
library(MASS)         # Stepwise regression (stepAIC)
library(lmtest)       # Model tests (bptest, dwtest)
library(sandwich)     # Robust standard errors (vcovHC)

# --- Missing data handling ---
library(mice)         # Multiple imputation 
set.seed(12345)

# --- Load dataset ---
df_orig <- read_csv("aug_train.csv")
df <- df_orig

# Quick overview of the dataset
summary(df)
str(df)
```


## Functions
```{r}
# -------------------------------
# Missing
# -------------------------------
count_missing <- function(x) {
  sum(is.na(x))
}

# -------------------------------
# Errors
# -------------------------------
count_errors <- function(x) {
  if (!is.factor(x)) return(0)
  sum(!is.na(x) & !(x %in% levels(x)))
}

# -------------------------------
# Outliers
# -------------------------------
count_outliers <- function(x) {
  if (!is.numeric(x)) return(0)
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  sum(x < (Q1 - 1.5 * IQR) | x > (Q3 + 1.5 * IQR), na.rm = TRUE)
}

# -------------------------------
# Severe outliers
# -------------------------------
count_outliers_severe <- function(x) {
  if (!is.numeric(x)) return(0)
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  sum(x < (Q1 - 3 * IQR) | x > (Q3 + 3 * IQR), na.rm = TRUE)
}
```


## Univariate Descriptive Analysis
• Original numeric variables corresponding to qualitative concepts have to be converted to factors.

• Original numeric variables corresponding to real quantitative concepts are kept as numeric but additional factors should also be created as a discretization of each numeric variable.

• Exploratory Data Analysis for each variables (numeric summary and graphic support).



### Variable 1: enrollee_id

```{r}
df$enrollee_id <- NULL

df <- df[!duplicated(df), ]
nrow(df_orig) - nrow(df)
```


### Variable 2: city

```{r}
df$city <- as.factor(df$city)
summary(df$city)
plot(df$city, main = "city")
```


### Variable 3: city_development_index

```{r}
summary(df$city_development_index)
plot(as.factor(df$city_development_index), main = "city_development_index")

df$f_city_dev_q <- cut(df$city_development_index,
                       breaks = quantile(df$city_development_index, probs = seq(0,1,0.25)),
                       include.lowest = TRUE,
                       labels = c("Low", "Mid-low", "Mid-high", "High"))

summary(df$f_city_dev_q)
plot(df$f_city_dev_q, main = "f_city_dev_q")
```


### Variable 4: gender

```{r}
df$gender <- as.factor(df$gender)
summary(df$gender)
plot(df$gender, main = "gender")
```


### Variable 5: relevent_experience

```{r}
df$relevent_experience <- as.factor(df$relevent_experience)
summary(df$relevent_experience)
plot(df$relevent_experience, main = "relevent_experience")
prop.table(table(df$relevent_experience))
```


### Variable 6: enrolled_university

```{r}
df$enrolled_university <- as.factor(df$enrolled_university)
summary(df$enrolled_university)
plot(df$enrolled_university, main = "enrolled_university")
```


### Variable 7: education_level

```{r}
df$education_level <- as.factor(df$education_level)
summary(df$education_level)
plot(df$education_level, main = "education_level")
```


### Variable 8: major_discipline

```{r}
df$major_discipline <- as.factor(df$major_discipline)
summary(df$major_discipline)
plot(df$major_discipline, main = "major_discipline")
```


### Variable 9: experience

```{r}
df$experience_num <- df$experience

df$experience_num[df$experience_num == "<1"] <- "0"
df$experience_num[df$experience_num == ">20"] <- "21"

df$experience_num <- as.numeric(df$experience_num)

summary(df$experience_num)
plot(as.factor(df$experience_num), main = "experience_num")

df$f_experience_q <- cut(df$experience_num,
                         breaks = quantile(df$experience_num, probs = seq(0,1,0.25), na.rm = TRUE),
                         include.lowest = TRUE,
                         labels = c("Low", "Mid-low", "Mid-high", "High"))
summary(df$f_experience_q)
plot(df$f_experience_q, main = "f_experience_q")
```


### Variable 10: company_size

```{r}
# Create a numeric variable company_size_num
df$company_size_num <- df$company_size

df$company_size_num[df$company_size_num == "<10"] <- "5"
df$company_size_num[df$company_size_num == "10/49"] <- "30"
df$company_size_num[df$company_size_num == "50-99"] <- "75"
df$company_size_num[df$company_size_num == "100-500"] <- "300"
df$company_size_num[df$company_size_num == "500-999"] <- "750"
df$company_size_num[df$company_size_num == "1000-4999"] <- "3000"
df$company_size_num[df$company_size_num == "5000-9999"] <- "7500"
df$company_size_num[df$company_size_num == "10000+"] <- "11000"

df$company_size_num <- as.numeric(df$company_size_num)

summary(df$company_size_num)
plot(as.factor(df$company_size_num), main="company_size_num")


# Create a factor using this numeric variable
df$f_company_size_q <- cut(df$company_size_num,
                         breaks = quantile(df$company_size_num, probs = seq(0,1,0.25), na.rm = TRUE),
                         include.lowest = TRUE,
                         labels = c("Low", "Mid-low", "Mid-high", "High"))
summary(df$f_company_size_q)
plot(df$f_company_size_q, main = "f_company_size_q")


# Make company_size an ordered factor
ordered_sizes <- c("<10","10/49","50-99", "100-500", "500-999", "1000-4999", "5000-9999", "10000+")

df$company_size <- factor(df$company_size,
                          levels = ordered_sizes,
                          ordered = TRUE)
summary(df$company_size)
plot(df$company_size, main = "company_size")
```


### Variable 11: company_type

```{r}
df$company_type <- as.factor(df$company_type)
summary(df$company_type)
plot(df$company_type, main = "company_type")
```


### Variable 12: last_new_job

```{r}
# Create a numeric variable last_new_job_num
df$last_new_job_num <- df$last_new_job

df$last_new_job_num[df$last_new_job_num == "never"] <- "0"
df$last_new_job_num[df$last_new_job_num == ">4"] <- "5"

df$last_new_job_num <- as.numeric(df$last_new_job_num)

summary(df$last_new_job_num)
plot(as.factor(df$last_new_job_num), main="last_new_job_num")


# Create ordered factor
ordered_lastjob <- c("never","1","2","3","4",">4")

df$last_new_job <- factor(df$last_new_job,
                          levels = ordered_lastjob,
                          ordered = TRUE)

summary(df$last_new_job)
plot(df$last_new_job, main = "last_new_job")
```


### Variable 13: training_hours

```{r}
summary(df$training_hours)
plot(as.factor(df$training_hours), main = "training_hours")

df$f_training_hours_q <- cut(df$training_hours,
                             breaks = quantile(df$training_hours, probs = seq(0,1,0.25)),
                             include.lowest = TRUE,
                             labels = c("Low", "Mid-low", "Mid-high", "High"))

summary(df$f_training_hours_q)
plot(df$f_training_hours_q, main = "f_training_hours_q")
```


### Variable 14: target

```{r}
df$target <- as.factor(df$target)
summary(df$target)
plot(df$target, main = "target")
prop.table(table(df$target))
```


## Data Quality Report

Per variable, count:
• Number of missing values
• Number of errors (including inconsistencies)
• Number of outliers
• Rank variables according the sum of missing values (and errors).


Per individuals, count:
• number of missing values
• number of errors,
• number of outliers
• Identify individuals considered as multivariant outliers.



Create variable adding the total number missing values, outliers and errors. Describe these variables, to which other variables exist higher associations.
• Compute the correlation with all other variables. Rank these variables according the correlation
• Compute for every group of individuals (group of age, size of town, singles, married, …) the mean of missing/outliers/errors values. Rank the groups according the computed mean.


TIPOS DE ERRORES POSIBLES (INCONSISTENCIAS):

Errores entre EXPERIENCE y LAST_NEW_JOB:

  Error 1 — experience_num = 0 pero last_new_job != "never"
  Error 2 — experience_num > 0 pero last_new_job = "never"
  Error 3 — last_new_job > experience_num
 
Errores entre EXPERIENCE y COMPANY_SIZE / COMPANY_TYPE

  Error 4 — experience_num = 0 pero company_size no es NA
  Error 5 — experience_num = 0 pero company_type no es NA
  Error 6 — company_size y company_type inconsistentes (NA en company_size y no en company_type, y viceversa)
  
Errores entre EDUCATION_LEVEL, ENROLLED_UNIVERSITY y MAJOR_DISCIPLINE

  Error 7 — education_level = "Primary School" y major_discipline != NA
  Error 8 — education_level = "High School" y major_discipline != NA
  Error 9 — major_discipline != NA pero education_level es bajo
  Error 10 — enrolled_university != "no_enrollment" y education_level =  "Primary School"
  
Errores entre TRAINING_HOURS y RELEVANT_EXPERIENCE
  Error 11 — Has relevant experience con experience_num = 0
  Error 12 — No relevant experience con experience_num > 10 (opcional)

```{r}
# Data quality per variable
vars <- names(df)

DQ_variable <- data.frame(
  missing = sapply(df, count_missing),
  errors = sapply(df, count_errors),
  outliers = sapply(df, count_outliers),
  severe_outliers = sapply(df, count_outliers_severe)
)
summary(DQ_variable)


# Data quality per individual
DQ_individual <- data.frame(
  missing         = apply(df, 1, count_missing),
  errors          = apply(df, 1, count_errors),
  outliers        = apply(df, 1, count_outliers),
  severe_outliers = apply(df, 1, count_outliers_severe)
)
summary(DQ_individual)

```






















## Imputation
```{r}



```


# PROFILING AND FEATURE SELECTION
```{r}



```

# MODEL WITH NUMERIC VARIABLES
```{r}



```

# RESIDUAL ANALYSIS 1
```{r}



```

# ADDING FACTORS
```{r}



```

# RESIDUAL ANALYSIS 2
```{r}



```

# ADDING INTERACTIONS 
```{r}



```

# FINAL RESIDUAL ANALYSIS 
```{r}



```


# GOODNESS OF FIT AND MODEL INTERPRETATION
```{r}



```

